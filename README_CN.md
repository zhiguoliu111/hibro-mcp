<div align="center">

# hibro - 通用智能记忆助手

**🌐 Language / 语言**

[English](./README.md) | [中文](./README_CN.md)

> hibro让任何 AI 编程工具记住你的一切，提供个性化的智能服务

## 🎯 这是什么？

**hibro** 是一个强大的通用智能记忆系统，支持任何兼容 MCP (Model Context Protocol) 协议的 AI 开发工具。它可以与 Claude Code、Cursor、Qoder、Trae 等多种 IDE 无缝集成，让你的 AI 助手能够：

- 📝 **记住你的偏好** - 代码风格、技术选型、工作习惯
- 🧠 **理解你的决策** - 架构设计、技术栈选择、项目规划
- 🔍 **智能检索信息** - 关键词搜索 + 语义相似度搜索
- 💡 **主动提供建议** - 基于历史数据推荐最佳实践
- 🔒 **保护数据安全** - 加密存储、自动备份、安全监控

## 😫 它解决什么痛点？

### 1. **AI 助手的"健忘症"**

**问题**：

- 每次新对话，Claude 都从零开始，不记得你的偏好
- 重复回答相同的问题，效率低下
- 无法利用历史决策经验

**hibro 解决方案**：
```
你: "我通常使用 React + TypeScript 开发"
hibro: ✅ 已记住你的技术栈偏好

[一周后，新对话]
Claude: 我看到你偏好使用 React + TypeScript，是否继续使用这个技术栈？
```

### 2. **项目上下文丢失**

**问题**：

- 切换项目时，Claude 不知道项目背景
- 重复解释项目架构和技术选型
- 无法利用项目历史经验

**hibro 解决方案**：
```
你: 项目进行到哪里了？
hibro: 📋 自动扫描项目并生成快照...

  📊 my-webapp 项目进度报告
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  🎯 项目概况：
  项目名称：my-webapp
  项目类型：web 应用
  技术栈：React, TypeScript, Node.js, PostgreSQL
  编程语言：TypeScript, JavaScript

  📈 项目统计：
  • 总文件数：245
  • 项目大小：12.5 MB
  • 依赖数量：48 个

  🎯 当前任务：实现用户认证功能
  📅 项目阶段：development
  📊 进度：65%

  📝 最近工作记录：
  • 2小时前：完成登录页面UI
  • 1天前：配置 JWT 认证
  • 3天前：设计用户数据库模型
```

### 3. **重复犯错**

**问题**：
- 忘记之前的错误和解决方案
- 重复踩相同的坑
- 无法从历史中学习

**hibro 解决方案**：
```
你: 遇到 CORS 错误
hibro: 💡 检测到你在 2 周前也遇到过类似问题
  上次解决方案：在 Express 中添加 cors 中间件
  相关代码：app.use(cors({ origin: 'http://localhost:3000' }))
```

### 4. **信息碎片化**

**问题**：
- 重要决策散落在各处
- 难以追溯决策原因
- 团队知识无法共享

**hibro 解决方案**：
```
你: 为什么选择 PostgreSQL 而不是 MongoDB？
hibro: 📖 根据记录，你在 2026-01-15 做出这个决策：
  原因：
  1. 需要复杂查询和事务支持
  2. 团队熟悉 SQL 数据库
  3. 数据一致性要求高
```

### 5. **多对话框信息隔离** ✨ **NEW**

**问题**：
- 多个 Claude 对话框之间信息不互通
- 在对话框 A 存储的偏好，对话框 B 不知道
- 需要重复说明相同的偏好和决策

**hibro 解决方案**：
```
对话框 A:
你: 记住，Java静态常量必须使用全大写和下划线命名
hibro: ✅ 已存储到记忆系统

对话框 B (几秒后):
你: Java静态常量规范是什么？
hibro: 📋 根据你的编码偏好：
  • Java静态常量必须使用全大写字母和下划线命名
  • 示例：MAX_SIZE、DEFAULT_TIMEOUT、API_BASE_URL
  • 避免使用驼峰命名如 maxSize
```

## ✨ 核心功能

### 🔍 项目自动扫描（新增 ✨）

**智能识别项目信息**：
```python
你: 项目进行到哪里了？
hibro 自动扫描：
  ✓ 项目类型（web/api/mobile/desktop/library）
  ✓ 技术栈（20+ 种技术自动识别）
  ✓ 框架（React, Vue, FastAPI, Django 等）
  ✓ 编程语言（Python, TypeScript, Java 等）
  ✓ 项目规模（文件数、大小、依赖数）
  ✓ 依赖关系（package.json, requirements.txt）
  ✓ 目录结构（深度分析）
```

**自动缓存机制**：
```
首次扫描：完整分析项目（< 2秒）
7天内再次查询：使用缓存，秒级响应
超过7天：自动重新扫描，保持信息新鲜
```

**使用场景**：
```
场景1 - 新项目了解：
  你: 项目进行到哪里了？
  → 自动扫描并生成项目快照

场景2 - 进度追踪：
  你: 查看项目进度
  → 显示当前任务、最近工作、统计数据

场景3 - 状态更新：
  你: 更新项目状态，当前在做登录功能，进度50%
  → 记录状态并更新活跃任务
```

### 🔄 多对话框实时同步（新增 ✨）

**核心机制**：
```python
# 基于3层同步机制
1. 数据库文件监听
   - 监听 SQLite 文件变化
   - 1秒内检测到数据库写入
   - 自动刷新缓存版本

2. 事件发布/订阅
   - 11种事件类型（记忆存储、偏好变化等）
   - 异步事件处理
   - 优先级通知机制

3. 缓存版本追踪
   - 每次变化版本号+1
   - Claude 通过版本号判断是否需要刷新
```

**实时同步流程**：
```
对话框 A                共享数据库                 对话框 B
   │                       │                         │
   ├─ 存储: Java常量大写 ──►│                         │
   │                       │                         │
   │                  写入数据库                      │
   │                       │                         │
   │                  文件变化事件 ───────────────────►│
   │                       │                    检测到变化
   │                       │                         │
   │                  发布事件:                      │
   │                  MEMORY_STORED                  │
   │                  PREFERENCE_CHANGED             │
   │                  DATABASE_CHANGED               │
   │                       │                         │
   │                       │                    缓存版本++
   │                       │                    版本: 5
   │                       │                         │
   ◄───────────────────────┴─────────────────────────┤
                                                下次查询时
                                                检测到版本变化
                                                自动获取最新记忆
```

**使用示例**：
```
对话框 A (工作区1):
你: 记住，MySQL字段命名都用小写
hibro: ✅ 已存储 (发布3个事件)
  📢 MEMORY_STORED
  📢 PREFERENCE_CHANGED
  📢 DATABASE_CHANGED

对话框 B (工作区2) - 几秒后:
你: MySQL字段命名规范是什么？
hibro: [检测到缓存版本从4→5，自动刷新]
  📋 根据你的编码偏好：
  • MySQL字段命名规范：所有字段名使用小写字母
  • 示例：user_id、created_at、user_name
  • 避免使用 UserId、CreatedAt 等大写形式
```

**监控同步状态**：
```
你: 查看数据库同步状态
hibro:
  ✅ 数据库监听器运行正常
  📊 统计信息：
  • 监听状态：运行中
  • 数据库路径：~/.hibro/memories.db
  • 变化检测次数：15 次
  • 最后变化时间：30秒前
  • 缓存版本：23

  📈 事件总线状态：
  • 工作线程：2 个
  • 发布事件数：45
  • 处理事件数：45
  • 订阅者数量：2
```

### 📚 智能记忆存储

```python
# 自动提取和存储
对话中提到：我决定使用 FastAPI 框架
hibro 自动：
  ✓ 提取类型：技术决策
  ✓ 评分重要性：0.8 (高)
  ✓ 生成语义向量
  ✓ 关联到当前项目
  ✓ 加密存储
```

### 🔍 双模式搜索

**1. 关键词搜索** - 精确匹配
```
搜索："PostgreSQL 配置"
结果：包含 "PostgreSQL" 和 "配置" 的记忆
```

**2. 语义搜索** - 理解含义
```
搜索："数据库性能优化"
结果：即使不包含这些词，也能找到相关的：
  - 索引优化策略
  - 查询性能提升
  - 缓存配置方案
```

### 🧠 深度推理

**因果关系分析**：
```
检测到因果链：
  选择微服务架构 → 需要容器化 → 选择 Docker
  → 需要编排工具 → 选择 Kubernetes
```

**预测性推理**：
```
基于历史模式预测：
  新 FastAPI 项目 → 可能需要：
    ✓ SQLAlchemy (ORM)
    ✓ Pydantic (数据验证)
    ✓ Alembic (数据库迁移)
```

### 💡 智能引导

**工具推荐**：
```
当前任务：创建新 API 端点
推荐工具：
  1. analyze_project_deeply - 分析现有 API 模式
  2. build_knowledge_graph - 查看 API 依赖关系
  3. get_smart_suggestions - 获取最佳实践建议
```

**学习路径**：
```
新手用户：
  第1步：基础记忆存储
  第2步：简单搜索
  第3步：项目上下文管理
  ...
```

### 🔒 安全保障

- **数据加密**：AES-256-GCM 加密存储
- **自动备份**：每日自动备份，支持恢复
- **安全监控**：实时检测异常访问
- **完整性检查**：定期验证数据完整性

## 🚀 快速开始

### 1. 安装

```bash
# 克隆仓库
git clone <repository-url>
cd hibro

# 运行安装脚本
python scripts/install.py
```

安装脚本会自动：
- ✅ 安装所有依赖
- ✅ 配置 MCP 集成
- ✅ 创建数据目录
- ✅ 生成配置文件

### 2. 选择运行模式

hibro 支持两种运行模式，根据你的使用场景选择：

#### 模式1：stdio模式（推荐单个IDE使用）

```bash
# 直接启动（stdio模式）
python hibro.py
```

**IDE配置**（任何支持MCP的IDE）：
```json
{
  "mcpServers": {
    "hibro": {
      "command": "python",
      "args": ["D:/projects/hibro/hibro.py"]
    }
  }
}
```

#### 模式2：网络守护进程模式（推荐多个IDE同时使用）

```bash
# 启动守护进程
python hibro.py daemon start

# 查看状态
python hibro.py daemon status

# 停止守护进程
python hibro.py daemon stop
```

**IDE配置**（任何支持MCP的IDE）：
```json
{
  "mcpServers": {
    "hibro": {
      "command": "tcp://localhost:8765"
    }
  }
}
```

### 3. 支持的IDE

hibro 支持任何兼容 MCP 协议的 IDE：

- ✅ **Claude Code** - 完全支持
- ✅ **Cursor** - 完全支持
- ✅ **Qoder** - 完全支持
- ✅ **Trae** - 完全支持
- ✅ **任何其他MCP兼容IDE** - 标准协议支持

### 4. 开始使用

### 5. 多IDE使用场景

#### 场景1：单个IDE使用（stdio模式）
```bash
# 启动方式
python hibro.py stdio
```
- ✅ 简单直接，无需额外配置
- ✅ 完全兼容现有IDE设置
- ✅ 资源占用最小

#### 场景2：多个IDE同时使用（网络模式）
```bash
# 启动守护进程
python hibro.py daemon start
```
然后所有IDE都配置连接到 `tcp://localhost:8765`

- ✅ 多个IDE共享同一份记忆数据
- ✅ 资源高效，只有一个服务器实例
- ✅ 数据一致性保证

#### 场景3：混合使用
```bash
# 同时支持两种模式
# IDE1 使用 stdio 模式
# IDE2, IDE3 连接到网络守护进程
```

## 🏗️ 通用架构设计

### 双模式架构

```
┌─────────────────────────────────────┐
│           stdio模式                  │
│                                     │
│  IDE → stdin/stdout → MCP Server    │
│                    ↓                │
│              Memory Engine          │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│          网络守护进程模式              │
│                                     │
│  IDE1 ↘                            │
│  IDE2 → tcp://localhost:8765 →     │
│  IDE3 ↗      MCP Daemon            │
│                    ↓                │
│           Shared Memory Engine      │
└─────────────────────────────────────┘
```

### 核心优势

1. **真正通用**：任何MCP兼容IDE都能使用
2. **灵活部署**：根据使用场景选择合适模式
3. **完全兼容**：现有配置无需修改
4. **资源高效**：避免多实例资源浪费
5. **数据一致**：多IDE共享同一份智能记忆

## 📖 使用示例

### 场景 1：项目进度查询（新功能 ✨）

```
你: 项目进行到哪里了？

hibro 自动扫描并返回：
  📊 my-webapp 项目进度报告
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  🎯 项目概况：
  项目名称：my-webapp
  项目类型：web 应用
  技术栈：React, TypeScript, Node.js
  框架：React
  编程语言：TypeScript, JavaScript

  📈 项目统计：
  • 总文件数：245
  • 总目录数：87
  • 项目大小：12.5 MB
  • 依赖数量：48

  🎯 当前任务：实现用户认证功能
  📊 进度：65%

  📝 最近工作：
  • 2小时前：完成登录页面UI
  • 1天前：配置 JWT 认证
  • 3天前：设计用户数据库模型

  💡 建议：
  • 继续完成 OAuth2 集成
  • 添加单元测试覆盖
```

### 场景 2：多IDE协作（新功能 ✨）

```
# 启动守护进程
python hibro.py daemon start

# Claude Code 中
你: 记住，Java静态常量必须使用全大写和下划线命名
hibro: ✅ 已存储到共享记忆系统

# Cursor 中（几秒后）
你: Java常量命名规范是什么？
hibro: 📋 根据你的编码偏好：
  • Java静态常量必须使用全大写字母和下划线命名
  • 示例：MAX_SIZE、DEFAULT_TIMEOUT、API_BASE_URL
  • 避免使用驼峰命名如 maxSize

# 所有IDE都能看到相同的记忆数据！
```

### 场景 3：记录技术决策

```
你: 我决定使用 Redis 做缓存，因为需要高并发支持

hibro 自动记录：
  类型：技术决策
  内容：选择 Redis 作为缓存方案
  原因：需要高并发支持
  项目：my-webapp
  重要性：0.8 (高)
  时间：2026-02-20 10:30
```

### 场景 3：查询历史决策

```
你: 之前为什么选择 PostgreSQL？

hibro 回答：
  根据记录（2026-01-15），你选择 PostgreSQL 是因为：
  1. 需要复杂查询和事务支持 ✓
  2. 团队熟悉 SQL 数据库 ✓
  3. 数据一致性要求高 ✓

  相关记忆：3 条
  相关项目：2 个
```

### 场景 4：获取智能建议

```
你: 我要开始一个新的 React 项目

hibro 建议：
  基于你的历史经验，建议：
  1. 使用 TypeScript (你 90% 的项目都在用)
  2. 配置 ESLint + Prettier (你的标准配置)
  3. 使用 React Router (你常用的路由方案)

  推荐工具链：
    - Vite (构建工具)
    - Zustand (状态管理)
    - React Query (数据获取)
```

### 场景 4：项目切换

```
你: 切换到 my-api 项目

hibro 加载上下文：
  📋 项目：my-api
  📁 路径：/path/to/my-api
  🔧 技术栈：FastAPI + SQLAlchemy + PostgreSQL
  📊 统计：
    - 总记忆：45 条
    - 技术决策：12 条
    - 关键问题：5 个
  🎯 活跃任务：实现支付功能

  最近工作：
    - 2天前：完成用户认证
    - 5天前：配置数据库迁移
    - 1周前：设计 API 架构
```

## 🎓 学习路径

### 新手用户 (Beginner)

1. **基础记忆** - 学习如何存储和检索信息
2. **项目关联** - 将记忆关联到具体项目
3. **简单搜索** - 使用关键词查找信息
4. **上下文理解** - 理解项目上下文的作用

### 中级用户 (Intermediate)

5. **语义搜索** - 使用自然语言搜索
6. **决策追踪** - 记录和查询技术决策
7. **工作流优化** - 利用历史经验提升效率
8. **团队协作** - 共享项目知识和经验

### 高级用户 (Advanced)

9. **深度分析** - 因果关系分析和预测推理
10. **知识图谱** - 构建和理解知识网络
11. **自动化工作流** - 创建智能工作流
12. **系统管理** - 安全配置和性能优化

## 🏗️ 系统架构

### 三层架构

```
┌─────────────────────────────────────┐
│      Claude Code (MCP Client)       │  你使用的 AI 助手
└──────────────┬──────────────────────┘
               │ MCP 协议
               ▼
┌─────────────────────────────────────┐
│     hibro MCP Server Layer        │  50+ 智能工具
│  • 记忆管理  • 智能分析  • 引导系统  │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│      Core Engine Layer              │  核心引擎
│  • Memory Engine  • AI 分析         │
│  • Security       • Backup          │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│        Storage Layer                │  数据存储
│  • SQLite 数据库  • 文件系统        │
│  • 加密存储      • 自动备份         │
└─────────────────────────────────────┘
```

### 核心模块

| 模块 | 职责 | 文件数 |
|------|------|--------|
| **core** | 核心引擎、记忆管理 | 4 |
| **intelligence** | AI 分析、推理引擎 | 11 |
| **guidance** | 智能引导、推荐系统 | 4 |
| **assistant** | 主动建议、工作流自动化 | 4 |
| **security** | 加密、安全监控 | 4 |
| **backup** | 数据备份、恢复 | 3 |
| **mcp** | MCP 协议实现 | 1 |
| **storage** | 数据存储、文件管理 | 4 |

## 🔧 配置

### 基础配置 (`~/.hibro/config.yaml`)

```yaml
# 记忆设置
memory:
  max_memories: 100000          # 最大记忆数
  default_importance: 0.5       # 默认重要性
  auto_learn: true              # 自动学习

# 语义搜索
semantic_search:
  model_name: "all-MiniLM-L6-v2"  # 语义模型
  default_similarity_threshold: 0.3
  enable_cache: true

# 安全设置
security:
  encrypt_data: true            # 加密数据
  session_timeout: 3600         # 会话超时（秒）

# 备份设置
backup:
  enabled: true                 # 启用备份
  interval_hours: 24            # 备份间隔
  max_backups: 10               # 保留备份数
  encrypt_backups: true         # 加密备份
```

### 环境变量

```bash
# 数据目录
export MYJAVIS_DATA_DIR=/path/to/data

# 加密密码
export MYJAVIS_PASSWORD=your_secure_password

# 日志级别
export MYJAVIS_LOG_LEVEL=DEBUG
```

## 📊 性能指标

### 系统容量
- **最大记忆数**: 100,000+
- **数据库大小**: 支持 10GB+
- **并发会话**: 100+
- **响应时间**: < 2秒

### 搜索性能
- **关键词搜索**: < 100ms
- **语义搜索**: < 500ms (首次)
- **语义搜索**: < 100ms (缓存)
- **推荐生成**: < 200ms

### 存储效率
- **压缩率**: 60-70%
- **缓存命中率**: 85%+
- **备份速度**: 50MB/s

## 🔐 安全特性

### 数据加密
- **算法**: AES-256-GCM
- **密钥派生**: PBKDF2 (100,000 迭代)
- **加密范围**: 数据库、备份、缓存

### 访问控制
- 会话超时机制
- 异常访问检测
- 审计日志记录

### 备份保障
- 自动备份（每日）
- 完整性验证
- 加密备份存储
- 灾难恢复支持

## 🆘 故障排除

### 常见问题

**Q: MCP 服务器启动失败？**
```
A: 运行诊断脚本
python test_mcp_startup.py

常见原因：
1. Python 版本 < 3.10 → 升级 Python
2. 缺少依赖 → pip install -r requirements.txt
3. 模型下载超时 → 等待下载完成或配置代理
```

**Q: 搜索没有结果？**
```
A: 调整搜索参数
- 降低 min_similarity 阈值（0.3 → 0.2）
- 增加 limit 数量（10 → 20）
- 使用更通用的关键词
```

**Q: 数据丢失怎么办？**
```
A: 从备份恢复
1. 查看可用备份：get_backup_statistics
2. 恢复备份：restore_backup
3. 验证数据完整性
```

**Q: 多个对话框之间能实时同步吗？** ✨ **NEW**
```
A: 可以！hibro 支持3层同步机制
1. 数据库文件监听 - 1秒内检测变化
2. 事件发布/订阅 - 11种事件类型
3. 缓存版本追踪 - 自动判断是否需要刷新

测试方法：
- 对话框 A: 记住，Java常量用UPPER_CASE命名
- 对话框 B: 立即询问"Java常量命名规范"
- 预期：对话框 B 能看到最新存储的规范

查看状态：调用 get_sync_status 和 get_event_bus_status
```

### 获取帮助

- 📖 [完整文档](./DEVELOPER_GUIDE.md)
- 🔧 [故障排除指南](./troubleshooting.md)
- 💡 [最佳实践](./best-practices.md)
- 📝 [使用示例](./usage-examples.md)

## 🗺️ 路线图

### 已完成 ✅

- **Stage 1**: 深度推理能力升级
  - 因果关系分析
  - 预测性推理
  - 知识图谱构建

- **Stage 2**: 自适应学习机制
  - 用户行为分析
  - 动态评分调整
  - 个性化推荐

- **Stage 3**: 智能助手能力
  - 主动建议系统
  - 工作流自动化
  - 智能提醒

- **Stage 4**: 安全与监控
  - 数据加密
  - 健康监控
  - 自动备份

- **Stage 5**: 用户体验增强 ✨
  - MCP 工具重构（53+ 工具）
  - 智能引导系统
  - 完整文档体系

- **Stage 6**: 项目智能管理 ✨ **NEW**
  - 自动项目扫描（20+ 技术栈识别）
  - 项目快照缓存（7天有效期）
  - 智能进度追踪
  - 活跃任务管理

### 计划中 🚧

- **智能触发机制** - 自动识别项目相关查询
- **多模态记忆** - 支持图片、代码、文档
- **团队协作** - 多用户、权限管理
- **API 服务化** - RESTful API
- **分布式存储** - 支持大规模部署
- **插件系统** - 第三方扩展支持

## 📈 统计数据

- **代码行数**: ~27,500 行
- **Python 文件**: 75 个
- **核心模块**: 13 个
- **MCP 工具**: 56+ 个
- **文档页数**: 6,500+ 行
- **新增功能**:
  - 项目自动扫描（2026-02-20）
  - 多对话框实时同步（2026-02-20）
  - 事件发布/订阅系统（2026-02-20）

## 🤝 贡献

我们欢迎所有形式的贡献！

### 如何贡献

1. Fork 仓库
2. 创建特性分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'feat: 添加新功能'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 创建 Pull Request

### 开发指南

- 遵循 PEP 8 代码规范
- 添加类型注解
- 编写单元测试
- 更新文档

详见 [开发者指南](./DEVELOPER_GUIDE.md)

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](../LICENSE) 文件

## 🙏 致谢

- [Claude Code](https://claude.ai/) - 优秀的 AI 助手
- [MCP SDK](https://github.com/modelcontextprotocol) - 强大的协议支持
- [sentence-transformers](https://www.sbert.net/) - 语义理解能力
- 所有贡献者和用户

---

<div align="center">

**🌐 Language / 语言**

[English](./README.md) | [中文](./README_CN.md)

---

**[⬆ 返回顶部](#hibro---通用智能记忆助手)**

Made with ❤️ by hibro Team

**版本**: 2.2.0 | **最后更新**: 2026-02-20 | **新增**: 多对话框实时同步

</div>
